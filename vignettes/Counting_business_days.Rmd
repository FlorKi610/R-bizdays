---
title: "Counting business days"
author: "Wilson Freitas"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Counting business days}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## How bizdays counts business days?

To compute the number of business days between two dates effectively and with a good performance, `bizdays` creates two indexes.
The two indexes are called forward and backward.
These indexes associate a number to each date from the calendar's `start_date` up to its `end_date`.
In the forward index, the first business day is 1, the second is 2 and so on.
The backward index starts in the end with the last business day equals 1 and goes increasing towards the begining.
This works fine in financial calculations because between two consecutive business days we have 1 day, in both indexes.
The non business days are gaps and they share the index with their business days neighbors, see the figure below.
The blue boxes are working days and the green ones nonworking days.

![bizdays index](bizdays_index.png "bizdays index")

Differently we can imagine that each business day in the sequence of dates of the calendar contributes with 1 and the non business days with 0.
The forward index does an accumulated sum starting from the begining and the backward does the same starting in the end.

As we can see in the figure above, from Tuesday to Monday we have 7 days (one week), starting at 1 and ending up at 7 in the current days index (which is represented by the `actual` calendar).
In the business days indexes the counting starts at 1 and ends up at 4 and 4 is the total number of business days shown.

To compute the number of business days between two dates bizdays subtracts the index values associated with the given dates in each index and take the minimum.
This is done to avoid having incorrect business days calculations in situations where the arguments `from` and `to` are given nonworking days.

Let's create a calendar with these dates to illustrate.

```{r message=FALSE, warning=FALSE}
library(bizdays)

create.calendar(name = "example1", weekdays = c("saturday", "sunday"), start.date = "2017-01-24", end.date = "2017-01-30", holidays = "2017-01-25")
calendars() # to list all calendars
```

Calling the `bizdays` function to compute the business days from 2017-01-24 to 2017-01-26 results in:

```{r}
bizdays("2017-01-24", "2017-01-26", "example1")
```

one business day which is the difference of index values, but the interval (2017-01-24, 2017-01-26) has two business days.
Another example, starting and ending up at the holiday, we get

```{r}
bizdays("2017-01-24", "2017-01-25", "example1")
bizdays("2017-01-25", "2017-01-26", "example1")
```


```{r}
bizdays("2017-01-25", "2017-01-28", "example1")
```

```{r}
offset("2017-01-25", 1, "example1")
```


This result happens because of the two indexes, if we consider only one index these function calls would return different results.

`bizdays` doesn't return the number of business days in a interval, it returns the jumps between business days into the interval.
This is the way days are counted in the financial insdustry to compound interest rates, for example.
`bizdays` calculations are straighforward when the arguments `from` and `to` are business days, and if any of these arguments are passed nonworking days the result might be unexpected.
To work around this situation we have the arguments `adjust_from` and `adjust_to` on `create.calendar`.
These have been created, to execute a date adjustment of the arguments `from` and `to` according to users needs.
These arguments can be set with one of these three functions:

- `adjust_none`: the default value, does not execute date adjustment
- `adjust_previous`: move the date for the previous business day if it is nonworking day
- `adjust_next`: move the date for the next business day if it is nonworking day

So the user can have more control on the resutls.